## Stock price trend forecast
In this section, we try to predict the rise and fall trends of stock prices (classified as "rising", "flat", and "falling") through machine learning models, combine sentiment analysis of news texts (sentiment scores and labels) and structured technical indicators (such as BI, BI_MA), build a multimodal feature set, explore the correlation between market sentiment and stock price fluctuations, and ultimately improve prediction accuracy and provide support for investment decisions.
### 1. data preprocessing
The data cleaning phase processed missing values ​​(filled with mean for numerical features and mode for categorical features) and encoded the target variable into numerical form (0, 1, 2). Then, sentiment scores and one-hot encoded sentiment labels were used as sentiment features, and technical indicators (such as BI_MA) were retained as structural features. SMOTE oversampling was used to solve the class imbalance problem, and the data was split in chronological order (80% for training set and 20% for test set) to simulate the real prediction scenario.
#### * Some data preprocessing codes are shown below:
price_related_cols = [
    'DlyPrc', 'DlyRetx', 'DlyVol',
    'DlyClose', 'DlyLow', 'DlyHigh', 'DlyOpen'
]

excluded_cols = [
    'date', 'title', 'content', 
    'HdrCUSIP', 'PERMNO', 'PERMCO', 
    'Ticker', 'sentiment_label'
] + price_related_cols  

features = data.drop(excluded_cols + ['Price_Change'], axis=1)

lags = 3
for col in ['sentiment_score', 'BI', 'BI_Simple']:
    for i in range(1, lags+1):
        features[f'{col}_lag{i}'] = data[col].shift(i)

features = features.iloc[lags:]
y = data['Price_Change'].iloc[lags:]

numeric_cols = features.select_dtypes(include=np.number).columns.tolist()
features[numeric_cols] = features[numeric_cols].fillna(features[numeric_cols].mean())

#### * Top 20 Features are as below :
<img width="400" alt="image" src="https://github.com/user-attachments/assets/ae5c4770-eb48-4102-b524-206d17791087" />

### 2. Model Training & Regressing
In the task of predicting stock price fluctuations, we selected three models: Random Forest, LightGBM and Logistic Regression, based on the following considerations: Random Forest can automatically process high-dimensional features, capture complex nonlinear relationships between features, and is suitable for mixed-type data; LightGBM has fast training speed, low memory usage, and supports efficient processing of high-dimensional sparse data (such as TF-IDF text features), which is suitable for optimizing the use of text features; the Logistic Regression model is simple and highly interpretable, and can clearly show the positive/negative impact of features, which is good for verifying the interpretability of sentiment features.
#### * Part of the model training code is as follows (taking the LightGBM model as an example):
model = Pipeline([
    ('preprocessor', preprocessor),
    ('smote', SMOTE(random_state=42)),
    ('classifier', lgb.LGBMClassifier(
        objective='multiclass',  
        num_class=3,            
        boosting_type='gbdt',
        n_estimators=200,
        learning_rate=0.05,
        max_depth=5,
        class_weight='balanced', 
        random_state=42
    ))
])

df = df.sort_values('date').reset_index(drop=True)
X = df[['content', 'sentiment_score', 'sentiment_label', 'BI', 'BI_Simple', 'BI_MA', 'BI_Simple_MA']]
y = df['Price_Change']

train_size = int(len(X)*0.8)
X_train, X_test = X.iloc[:train_size], X.iloc[train_size:]
y_train, y_test = y.iloc[:train_size], y.iloc[train_size:]
model.fit(X_train, y_train)

y_pred = model.predict(X_test)
class_names = le.classes_

print("the report:")
print(classification_report(y_test, y_pred, target_names=class_names))
#### *Example of a regression report output:
<img width="400" alt="image" src="https://github.com/user-attachments/assets/0e8bb705-0cfa-46cb-8288-f013b10082dd" />

### 3. visualization & analysis
In the visualization of model results, we use the accuracy comparison chart to intuitively display the performance of each model, use gradient color matching and shadow texture to highlight the significant advantages of the model, and add a 65% baseline to clarify the optimization space; use the prediction probability distribution chart to analyze the model's prediction confidence for each category, explore the confidence interval of the high confidence area, and reveal the ambiguity of the model's classification of intermediate states; use the feature importance chart to reveal the sentiment score and text features, and verify the important contribution of sentiment analysis to stock price prediction. These visualization methods present the model performance in an intuitive and professional way.
#### * Random Forest Model Visualization Results：
<img width="400" alt="image" src="https://github.com/user-attachments/assets/72cb363c-8231-44ff-ad6c-342ecfbc2857" />
